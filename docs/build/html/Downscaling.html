

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Downscaling &mdash; agrodem 31-01-2020 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Future Scenarios" href="Future Scenarios.html" />
    <link rel="prev" title="Irrigation model" href="Irrigation model.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> agrodem
          

          
          </a>

          
            
            
              <div class="version">
                Version 2020.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Irrigation model.html">Irrigation model</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Downscaling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#input-data-preparation">Input data preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameterization-model-run">Parameterization &amp; model run</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output-data">Output data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#special-notes">Special notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Future Scenarios.html">Future Scenarios</a></li>
<li class="toctree-l1"><a class="reference internal" href="Post analysis.html">Post analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="License.html">Licence</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">agrodem</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Downscaling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Downscaling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="downscaling">
<h1>Downscaling<a class="headerlink" href="#downscaling" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>High resolution crop allocation datasets are not usually available in open access sources. ‘Downscaling models’ for land cover use high-resolution biophysical data (e.g. on temperature, precipitation and/or soil pH) which have predictive power over low-resolution input data (e.g. national or admin level aggregate values of harvested area, production etc.).</p>
<p>In order to do so, we have used the <a class="reference external" href="https://mygeohub.org/resources/flat">Fine Scale Land Allocation Tool or FLAT</a> model.  FLAT is a statistical-based open access tool that combines dependent variable data measured at an aggregate level (e.g., state/provincial or national) with independent variable data measured at the pixel level to produce estimates of the dependent variable at the pixel level.</p>
</div>
<div class="section" id="input-data-preparation">
<h2>Input data preparation<a class="headerlink" href="#input-data-preparation" title="Permalink to this headline">¶</a></h2>
<p>In terms of the crop harvested area, harvested land shares of e.g. maize were extracted from the <a class="reference external" href="http://www.fao.org/land-water/land/land-governance/land-resources-planning-toolbox/category/details/en/c/1026341/">FAO Agro MAPS Global Spatial Database of Agricultural Land use Statistics</a>. The database provides agricultural statistics and data collected and compiled from national resources, surveys, and official in-country agencies, assuring some degree of consistency across different agricultural products and geographic areas. This consistency is considered highly important in this developed modelling approach, making it easier replicable and further applied to other regions or agricultural products by avoiding highly processed or already disaggregated input data which might be based on ad hoc assumptions or poorly documented methodological steps.</p>
<p>For the purposes of this study level 2 administrative crop data were used as shown in Figure below.</p>
<div class="figure align-center" id="id1">
<img alt="_images/Downscaling_Fig.jpg" src="_images/Downscaling_Fig.jpg" />
<p class="caption"><span class="caption-text">Visualisation of harvested area data of rainfed maize in Mozambique as retrieved from FAO Agro-Maps</span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In case input data is outdated, they will need to be projected to the base year. For example in this case the total harvested area for maize was equal to only 782,608 ha in 2008 (input data), while 2017-18 FAO estimates indicate about 1,962,000 ha in Mozambique. This is included in a python script available as <a class="reference external" href="https://github.com/akorkovelos/agrodem/blob/master/agrodem_preprocessing/Downscaling/Downscaling_prepping/Preparing_Agro_Maps.ipynb">Preparing Agro Maps</a>.</p>
</div>
<p>Then, the above dataset is transformed into a base (vector) layer at the targeted downscaling resolution. This is used later on to extract the predictor attributes per location. The steps for this are as follows:</p>
<ol class="arabic simple">
<li>Project crop layer to target crs (in this case EPSG: 32737 – WGS 84/UTM zone 37S )</li>
<li>Calculate “area” in sq.km and “perimeter” in km for listed admin areas</li>
<li>Convert “area” from sq.km to ha</li>
<li>Create the base grid mesh (10km, 5km, 1km, 500m or 250m)</li>
<li>Only keep locations where harvested area for the listed crop is available.</li>
<li>Convert polygons to centroids indicating the location of crops at the selected resolution.</li>
<li>Export output as a .csv file</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order to facilitate the process, we have developed a <a class="reference external" href="https://github.com/akorkovelos/agrodem/blob/master/agrodem_preprocessing/Downscaling/Downscaling_prepping/Agrodem_plugin_creating_basegrid-master.zip">QGIS plugin</a> that together with instructions for installationa dn use is available online.</p>
</div>
<p>Finally, once base (vector) data layer is ready and available as a .csv file, predictor values are attributed. As predictors in the FLAT model, we may use the following 15 variables:</p>
<ul class="simple">
<li>Average temperature</li>
<li>Average solar irradiation</li>
<li>Average precipitation</li>
<li>Average wind speed</li>
<li>Soil Ph in H20</li>
<li>Depth to bedrock</li>
<li>Bulk density</li>
<li>lay content</li>
<li>Texture class</li>
<li>Soil organic carbon</li>
<li>Drainage class</li>
<li>EVI</li>
<li>NDVI</li>
<li>Elevation - Slope</li>
<li>Cropland extent</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All of the above data can be collected either in their raw format or using a Python script (<a class="reference external" href="https://github.com/akorkovelos/agrodem/blob/master/agrodem_preprocessing/Downscaling/Downscaling_prepping/GEE_Imagery_Extraction.ipynb">GEE_Imagery_Extraction</a>) that was developed specifically for the extraction of the Images and ImageCollections using the GEE API.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In order to automate the attribute extraction process, a Python script (<a class="reference external" href="https://github.com/akorkovelos/agrodem/blob/master/agrodem_preprocessing/Downscaling/Downscaling_prepping/FLAT%20prepping.ipynb">FLAT prepping</a>) was developed for further processing of all geospatial data, and an aggregated final .csv table was extracted as the final input to the econometric model. Data processing included:</p>
<ul class="simple">
<li>data cleaning</li>
<li>transformation and integration from the different sources</li>
<li>accounting for missing and extreme values (null or corrupted)</li>
<li>variable name inconsistencies</li>
<li>variable type conversions, scaling and data normalization</li>
</ul>
<p class="last">With regards to the imported geospatial layers – raster (.tiff) and vector (.shp) files – each dataset is expressed and stored as a single vertical layer in the same coordinate system e.g. EPSG: 32737 – WGS 84/UTM zone 37S (+proj=utm +zone=37 +south +datum=WGS84 +units=m +no_defs for Mozambique).</p>
</div>
<div class="figure align-center" id="id2">
<img alt="_images/Downscaling_Fig2.jpg" src="_images/Downscaling_Fig2.jpg" />
<p class="caption"><span class="caption-text">Snapshot of the .csv file used as input to the FLAT model</span></p>
</div>
</div>
<div class="section" id="parameterization-model-run">
<h2>Parameterization &amp; model run<a class="headerlink" href="#parameterization-model-run" title="Permalink to this headline">¶</a></h2>
<p>The FLAT model can be executed with the following steps.</p>
<p><strong>Step 1.</strong>     Go to directory:</p>
<blockquote>
<div>&gt;/ FLAT_model/src</div></blockquote>
<p><strong>Step 2.</strong>     In the directory run:</p>
<blockquote>
<div><p>&gt;/ Rscript RforFLAT.R flat_input.csv 0.534 1 15</p>
<p>where:</p>
<ul class="simple">
<li>flat_input.csv is the output csv of FLAT prepping process</li>
<li>0.534 is the target spatial resolution in arc.min</li>
<li>1 is the number of modelled crops</li>
<li>15 is the number of independent variables</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This process requires <a class="reference external" href="https://www.r-project.org/">R</a> to be installed at your working station. Running the above script creates nine derivative .csv files that the FLAT model requires to run. These are usually named as cropnames, pixels, states, data, statelevelcroparea, name, pixelarea, statelevelareainfo and variables.</p>
</div>
<p><strong>Step 3.</strong>     Copy the nine .csv files into the resource directory:</p>
<blockquote>
<div>&gt;/ FLAT_model/src/resource</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">FLAT.gms should be located in the same directory as well - default by installation.</p>
</div>
<p><strong>Step 4.</strong>     Open GAMS Terminal; move to resource directory and run:</p>
<blockquote>
<div>&gt;/ gams FLAT.gms</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This will run FLAT model. Once complete, the log file (FLAT.ist) will be generated. This can be used to monitor the specifics of the run and track any issue in the debugging process (if needed). The result file is a .dat file usually under the name “finalresults.dat”. Other output files might include “Pixel-level cropland predictions against FAO aggregate values”; “Coefficient estimates”; ”Standard error”; “Covariate matrix for parameter estimation”.</p>
</div>
<p><strong>Step 5.</strong>     Export results (Optional)</p>
<blockquote>
<div><p>&gt;/ FLAT_model/src</p>
<p>run &gt; Rscript dattotiff.R maize finalresults.dat (to generate a raster file (.tiff) of the results) or</p>
<p>run &gt; Result.r (to export results in .csv format)</p>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Transformation of the result (.dat) file into a .csv file that can later on be used for the irrigation model is also available in <a class="reference external" href="https://github.com/akorkovelos/agrodem/blob/master/agrodem_preprocessing/Downscaling/FLAT_model/finalresults.dat">Dat to csv</a>.</p>
</div>
</div>
<div class="section" id="output-data">
<h2>Output data<a class="headerlink" href="#output-data" title="Permalink to this headline">¶</a></h2>
<p>The output file provides a prediction the downscaled crop allocation. Each location (point in the vector layer) is attributed a fraction of the total harvested areas of the initial value (this refers to the admin level 2 value in this case). Aggregation of the downscaled results sum up to the original values.</p>
<div class="figure align-center" id="id3">
<img alt="_images/Downscaling_Fig3.jpg" src="_images/Downscaling_Fig3.jpg" />
<p class="caption"><span class="caption-text">Example output from the downscaling process for rainfed maize in Mozambique</span></p>
</div>
</div>
<div class="section" id="special-notes">
<h2>Special notes<a class="headerlink" href="#special-notes" title="Permalink to this headline">¶</a></h2>
<p>The downscaling process is a good – yet experimental – way to achieve higher granularity of crop distribution, especially in areas where there is data scarcity.</p>
<p>The FLAT model that was selected in this assignment is open source (although GAMS is needed for big datasets) and straightforward to test, use and&nbsp;customize.&nbsp;It predicts cropland allocation using pixel-level biophysical attributes which&nbsp;are openly available at the desired spatial resolution (1 km). The&nbsp;econometric approach provides estimates of the effects of biophysical factors on cropland allocation.</p>
<p>FLAT performance metrics are in alignment with available literature; visual inspection of results does also agree with qualitative findings from sample agricultural survey. However, the selected cross-validation approach highlighted that inconsistencies in the sample dataset are high to achieve any satisfactory results. This highlights the need for standardization of collection, processing and dissemination of survey related datasets.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Future Scenarios.html" class="btn btn-neutral float-right" title="Future Scenarios" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Irrigation model.html" class="btn btn-neutral float-left" title="Irrigation model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 - KTH dESA

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>